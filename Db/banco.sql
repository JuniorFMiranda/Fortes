/******************************************************************************/
/***          Generated by IBExpert 2012.02.21 11/06/2023 09:39:17          ***/
/******************************************************************************/

/*SET SQL DIALECT 3;

SET NAMES UTF8;

SET CLIENTLIB 'C:\Program Files (x86)\Firebird\Firebird_2_5\bin\fbclient.dll';

CREATE DATABASE 'C:\Fortes\Db\banco.fdb'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 16384
DEFAULT CHARACTER SET UTF8 COLLATION UTF8;*/



/******************************************************************************/
/***                               Generators                               ***/
/******************************************************************************/

CREATE GENERATOR GEN_ABASTECIMENTO_ID;
SET GENERATOR GEN_ABASTECIMENTO_ID TO 2;

CREATE GENERATOR GEN_ABASTECIMENTO_ITEM_ID;
SET GENERATOR GEN_ABASTECIMENTO_ITEM_ID TO 3;

CREATE GENERATOR GEN_BOMBA_ID;
SET GENERATOR GEN_BOMBA_ID TO 4;

CREATE GENERATOR GEN_COMBUSTIVEL_ID;
SET GENERATOR GEN_COMBUSTIVEL_ID TO 2;

CREATE GENERATOR GEN_TANQUE_ID;
SET GENERATOR GEN_TANQUE_ID TO 2;



/******************************************************************************/
/***                                 Tables                                 ***/
/******************************************************************************/
CREATE TABLE COMBUSTIVEL (
    ID_COMBUSTIVEL   INTEGER NOT NULL,
    DESCRICAO        VARCHAR(60) NOT NULL,
    VALOR            DECIMAL(18,2) NOT NULL,
    PERCENTUAL_ICMS  DECIMAL(8,2) NOT NULL
);

CREATE TABLE TANQUE (
    ID_TANQUE       INTEGER NOT NULL,
    ID_COMBUSTIVEL  INTEGER NOT NULL
);

CREATE TABLE BOMBA (
    ID_BOMBA   INTEGER NOT NULL,
    ID_TANQUE  INTEGER NOT NULL
);


CREATE TABLE ABASTECIMENTO (
    ID_ABASTECIMENTO  INTEGER NOT NULL,
    DATA              DATE DEFAULT CURRENT_DATE NOT NULL
);

CREATE TABLE ABASTECIMENTO_ITEM (
    ID_ABASTECIMENTO_ITEM  INTEGER NOT NULL,
    ID_ABASTECIMENTO       INTEGER NOT NULL,
    ID_COMBUSTIVEL         INTEGER NOT NULL,
    QUANTIDADE             DECIMAL(18,2) DEFAULT 0 NOT NULL,
    VALOR_ICMS             DECIMAL(18,2) DEFAULT 0 NOT NULL,
    VALOR                  DECIMAL(18,2) DEFAULT 0 NOT NULL,
    TOTAL                  DECIMAL(18,2) DEFAULT 0,
    DESCRICAO              VARCHAR(60) CHARACTER SET ISO8859_1 NOT NULL COLLATE PT_BR,
    PERCENTUAL_ICMS        DECIMAL(18,2) DEFAULT 0 NOT NULL
);

INSERT INTO COMBUSTIVEL (ID_COMBUSTIVEL, DESCRICAO, VALOR, PERCENTUAL_ICMS) VALUES (1, 'GASOLINA', 6, 15);
INSERT INTO COMBUSTIVEL (ID_COMBUSTIVEL, DESCRICAO, VALOR, PERCENTUAL_ICMS) VALUES (2, 'OLEO DIESEL', 5, 15);

COMMIT WORK;

INSERT INTO TANQUE (ID_TANQUE, ID_COMBUSTIVEL) VALUES (1, 1);
INSERT INTO TANQUE (ID_TANQUE, ID_COMBUSTIVEL) VALUES (2, 2);

COMMIT WORK;

INSERT INTO BOMBA (ID_BOMBA, ID_TANQUE) VALUES (1, 1);
INSERT INTO BOMBA (ID_BOMBA, ID_TANQUE) VALUES (2, 1);
INSERT INTO BOMBA (ID_BOMBA, ID_TANQUE) VALUES (3, 2);
INSERT INTO BOMBA (ID_BOMBA, ID_TANQUE) VALUES (4, 2);

COMMIT WORK;

INSERT INTO ABASTECIMENTO (ID_ABASTECIMENTO, DATA) VALUES (1, '2023-06-10');
INSERT INTO ABASTECIMENTO (ID_ABASTECIMENTO, DATA) VALUES (2, '2023-06-10');

COMMIT WORK;

INSERT INTO ABASTECIMENTO_ITEM (ID_ABASTECIMENTO_ITEM, ID_ABASTECIMENTO, ID_COMBUSTIVEL, QUANTIDADE, VALOR_ICMS, VALOR, TOTAL, DESCRICAO, PERCENTUAL_ICMS) VALUES (3, 2, 1, 150, 135, 6, 900, 'GASOLINA', 15);
INSERT INTO ABASTECIMENTO_ITEM (ID_ABASTECIMENTO_ITEM, ID_ABASTECIMENTO, ID_COMBUSTIVEL, QUANTIDADE, VALOR_ICMS, VALOR, TOTAL, DESCRICAO, PERCENTUAL_ICMS) VALUES (1, 1, 2, 200, 150, 5, 1000, 'OLEO DIESEL', 15);
INSERT INTO ABASTECIMENTO_ITEM (ID_ABASTECIMENTO_ITEM, ID_ABASTECIMENTO, ID_COMBUSTIVEL, QUANTIDADE, VALOR_ICMS, VALOR, TOTAL, DESCRICAO, PERCENTUAL_ICMS) VALUES (2, 1, 1, 100, 90, 6, 600, 'GASOLINA', 15);

COMMIT WORK;





/******************************************************************************/
/***                           Unique Constraints                           ***/
/******************************************************************************/

ALTER TABLE TANQUE ADD CONSTRAINT UNQ_TANQUE_COMBUSTIVEL UNIQUE (ID_COMBUSTIVEL);


/******************************************************************************/
/***                              Primary Keys                              ***/
/******************************************************************************/

ALTER TABLE ABASTECIMENTO ADD CONSTRAINT PK_ABASTECIMENTO PRIMARY KEY (ID_ABASTECIMENTO);
ALTER TABLE ABASTECIMENTO_ITEM ADD CONSTRAINT PK_ABASTECIMENTO_ITEM PRIMARY KEY (ID_ABASTECIMENTO_ITEM);
ALTER TABLE BOMBA ADD CONSTRAINT PK_BOMBA PRIMARY KEY (ID_BOMBA);
ALTER TABLE COMBUSTIVEL ADD CONSTRAINT PK_COMBUSTIVEL PRIMARY KEY (ID_COMBUSTIVEL);
ALTER TABLE TANQUE ADD CONSTRAINT PK_TANQUE PRIMARY KEY (ID_TANQUE);


/******************************************************************************/
/***                              Foreign Keys                              ***/
/******************************************************************************/

ALTER TABLE ABASTECIMENTO_ITEM ADD CONSTRAINT FK_ABASTECIMENTO_ITEM_1 FOREIGN KEY (ID_ABASTECIMENTO) REFERENCES ABASTECIMENTO (ID_ABASTECIMENTO) ON DELETE CASCADE;
ALTER TABLE ABASTECIMENTO_ITEM ADD CONSTRAINT FK_ABASTECIMENTO_ITEM_2 FOREIGN KEY (ID_COMBUSTIVEL) REFERENCES COMBUSTIVEL (ID_COMBUSTIVEL);
ALTER TABLE BOMBA ADD CONSTRAINT FK_BOMBA_1 FOREIGN KEY (ID_TANQUE) REFERENCES TANQUE (ID_TANQUE) ON DELETE CASCADE;
ALTER TABLE TANQUE ADD CONSTRAINT FK_TANQUE_COMBUSTIVEL FOREIGN KEY (ID_COMBUSTIVEL) REFERENCES COMBUSTIVEL (ID_COMBUSTIVEL) ON DELETE CASCADE ON UPDATE CASCADE;


/******************************************************************************/
/***                                Triggers                                ***/
/******************************************************************************/


SET TERM ^ ;



/******************************************************************************/
/***                          Triggers for tables                           ***/
/******************************************************************************/



/* Trigger: ABASTECIMENTO_BI */
CREATE TRIGGER ABASTECIMENTO_BI FOR ABASTECIMENTO
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_abastecimento is null) then
    new.id_abastecimento = gen_id(gen_abastecimento_id,1);
end
^

/* Trigger: ABASTECIMENTO_ITEM_BI */
CREATE TRIGGER ABASTECIMENTO_ITEM_BI FOR ABASTECIMENTO_ITEM
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_abastecimento_item is null) then
    new.id_abastecimento_item = gen_id(gen_abastecimento_item_id,1);
end
^

/* Trigger: BOMBA_BI */
CREATE TRIGGER BOMBA_BI FOR BOMBA
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_bomba is null) then
    new.id_bomba = gen_id(gen_bomba_id,1);
end
^

/* Trigger: COMBUSTIVEL_BI */
CREATE TRIGGER COMBUSTIVEL_BI FOR COMBUSTIVEL
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_combustivel is null) then
    new.id_combustivel = gen_id(gen_combustivel_id,1);
end
^

/* Trigger: TANQUE_BI */
CREATE TRIGGER TANQUE_BI FOR TANQUE
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_tanque is null) then
    new.id_tanque = gen_id(gen_tanque_id,1);
end
^

SET TERM ; ^



/******************************************************************************/
/***                          Fields descriptions                           ***/
/******************************************************************************/

DESCRIBE FIELD ID_ABASTECIMENTO TABLE ABASTECIMENTO
'ID único';

DESCRIBE FIELD DATA TABLE ABASTECIMENTO
'Data do abastecimento';

DESCRIBE FIELD ID_ABASTECIMENTO_ITEM TABLE ABASTECIMENTO_ITEM
'ID único';

DESCRIBE FIELD ID_ABASTECIMENTO TABLE ABASTECIMENTO_ITEM
'ID do Atendimento';

DESCRIBE FIELD ID_COMBUSTIVEL TABLE ABASTECIMENTO_ITEM
'ID do combustivel';

DESCRIBE FIELD QUANTIDADE TABLE ABASTECIMENTO_ITEM
'Quantidade abastecida';

DESCRIBE FIELD VALOR_ICMS TABLE ABASTECIMENTO_ITEM
'Valor do Imposto';

DESCRIBE FIELD VALOR TABLE ABASTECIMENTO_ITEM
'Valor por litro';

DESCRIBE FIELD TOTAL TABLE ABASTECIMENTO_ITEM
'Valor total do abastecimento';

DESCRIBE FIELD DESCRICAO TABLE ABASTECIMENTO_ITEM
'DESCRICAO DO COMBUSTÍVEL PARA
NÂO TER QUE FAZER UM LOOCKUP NESTE
BREVE EXEMPLO E MANTER HISTÓRICO';

DESCRIBE FIELD PERCENTUAL_ICMS TABLE ABASTECIMENTO_ITEM
'PERCETUAL DE ICMS PARA
NÂO TER QUE FAZER UM LOOCKUP
NESTE BREVE EXEMPLO E MANTER HISTÓRICO';

DESCRIBE FIELD ID_BOMBA TABLE BOMBA
'ID único';

DESCRIBE FIELD ID_TANQUE TABLE BOMBA
'ID do tanque';

DESCRIBE FIELD ID_COMBUSTIVEL TABLE COMBUSTIVEL
'ID único';

DESCRIBE FIELD DESCRICAO TABLE COMBUSTIVEL
'DESCRIÇÃO';

DESCRIBE FIELD VALOR TABLE COMBUSTIVEL
'PREÇO';

DESCRIBE FIELD PERCENTUAL_ICMS TABLE COMBUSTIVEL
'Percentual do imposto';

DESCRIBE FIELD ID_TANQUE TABLE TANQUE
'ID único';

DESCRIBE FIELD ID_COMBUSTIVEL TABLE TANQUE
'ID do combustível';

